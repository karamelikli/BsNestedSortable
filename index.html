<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" contents="width=device-width, initial-scale=1.0">
    <title>bootstrap Nested Sortable</title>

    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"
        integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
              rel="stylesheet"> -->



    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->
    <script src="./js/jquery-ui.js"></script>
    <link href="./css/BsNestedSortable.min.css" rel="stylesheet" />
    <script src="./js/BsNestedSortable.js"></script>
</head>

<body>
    <div class="container">
        <div class="row">
            <p></p>
            <ul id="tree"></ul>
        </div>
    </div>

    <script>
        const myData = [
            {
                id: 1,
                parent_id: 0,
                title: 'Branch 1',
                description: '<p>Check out the <a href="http://api.jquery.com/text/" rel="noreferrer">text</a> method.</p>',
            },
            {
                id: 2,
                parent_id: 1,
                title: 'Branch 2',
                img: 'images/profile.jpg'
            },
            {
                id: 3,
                parent_id: 2,
                title: 'Branch 3',
                description: 'Description of Branch 3',

            },
            {
                id: 4,
                parent_id: 3,
                title: 'Branch 4',
                description: '',
                myorder:2,

            },
            {
                id: 5,
                parent_id: 4,
                title: 'Branch 5',
                img: 'images/snow.jpeg',
                description: '<div class="comment-body js-comment-edit-hide">\nTest description</div>',

            },
            {
                id: 6,
                parent_id: 2,
                title: 'Branch 6',

            }, {
                id: 8,
                parent_id: 6,
                img: 'images/coding.jpg',
                title: 'Branch 8',
                description: '',

            },
            {
                id: 9,
                parent_id: 3,
                title: 'Branch 9',
                description: '',
                myorder:1

            },
            {
                id: 7,
                img: 'images/coding.jpg',
                parent_id: 10,
                title: 'Branch 7',

            },

            {
                title: 'Branch 10',
                id: 10,
                parent_id: 9,
                description: '',

            },
        ];

        $(document).ready(function () {
            const myAjaxRequest = async function (obj, type, url = "proceeding.php") {
                await $("#proceeding-modal").modal({ backdrop: 'static', keyboard: false, }).modal("show");
                let theResult = false;
                await $.ajax({
                    url: url,
                    type: "POST",
                    data: {
                        postArray: obj,
                        type: type
                    },
                    success: function (data) {
                        const returnVals = JSON.parse(data);
                        console.log(returnVals.message);
                        $("#proceeding-modal").modal("hide");
                        if ($("#proceeding-modal").css("display") == "none") {
                            $('#proceeding-modal').on('shown.bs.modal', function (e) {
                                $("#proceeding-modal").modal("hide");
                            })
                        }
                        theResult = true;
                    },
                    error: function (error, exception) {
                        $("#proceeding-modal").modal("hide");
                        if ($("#proceeding-modal").css("display") == "none") {
                            $('#proceeding-modal').on('shown.bs.modal', function (e) {
                                $("#proceeding-modal").modal("hide");
                            })
                        }
                        theResult = false;
                        errorAlert(error, exception);
                    },
                })
                return theResult;
            }
            const input = {
                data: myData, // {}, myData
                options: {
                    modal: {
                        id: "#myModal",
                        ModalDelete: "#myModalDelete",
                        name: "#CatName",
                        description: "#CatDescId",
                        image: "#image"
                    },
                    maxLevel: 10,
                    dataAttributes: {
                        id: 'id__',
                        parent: 'parent__',
                    },
                    dataKeys: {
                        id: 'id',
                        parent: 'parent_id',
                        title: 'title',
                        description: 'description',
                        image: 'img',
                        order:"myorder"
                    }
                },
                serializeOption: {
                    method: "JSON", // JSON alert console asVar
                    call: "val", // html val text jquery .html() ,.val() or .text()
                    outPuts: {
                        catObj: "#catObj", // the places which will have all categories
                        parentArr: "#parentArr", // parents array
                        childrenArr: "#childrenArr", // children array
                        Hierarchy: "#hierarchy", // expanded hierarchical array
                        minHierarchy: "#minHierarchy", // minimized hierarchical array
                        allParentsArr: "#allParentsArr", // all of parents
                        allChildrenArr: "#allChildrenArr" // all of children
                    }
                },
                eventsOptions: {
                    onComplete: async function (_, newSer) {
                        await $("#proceeding-modal").modal({ backdrop: 'static', keyboard: false, }).modal("show");
                        function timeout(ms) {
                            return new Promise(resolve => setTimeout(resolve, ms));
                        }
                        await timeout(500);
                        console.log("Completed");
                        console.log(JSON.stringify(newSer));
                        $("#proceeding-modal").modal("hide");
                        if ($("#proceeding-modal").css("display") == "none") {
                            $('#proceeding-modal').on('shown.bs.modal', function (e) {
                                $("#proceeding-modal").modal("hide");
                            })
                        }
                        return true;
                    },
                    onDelete: async function (_, deletedObj) {
                        return await myAjaxRequest(deletedObj, "delete");
                    },
                    onEdit: async function (_, editedObj) {
                        // return await myAjaxRequest(editedObj, "edit");
                        await $("#proceeding-modal").modal({ backdrop: 'static', keyboard: false, }).modal("show");
                        function timeout(ms) {
                            return new Promise(resolve => setTimeout(resolve, ms));
                        }
                        await timeout(1000);
                        $("#proceeding-modal").modal("hide");
                        if ($("#proceeding-modal").css("display") == "none") {
                            $('#proceeding-modal').on('shown.bs.modal', function (e) {
                                $("#proceeding-modal").modal("hide");
                            })
                        }
                        console.log("Edited"); console.log(editedObj);
                        return true;
                    },
                    onAdd: async function (_, addedObj) {
                        await $("#proceeding-modal").modal({ backdrop: 'static', keyboard: false, }).modal("show");
                        function timeout(ms) {
                            return new Promise(resolve => setTimeout(resolve, ms));
                        }
                        await timeout(1000);
                        $("#proceeding-modal").modal("hide");
                        if ($("#proceeding-modal").css("display") == "none") {
                            $('#proceeding-modal').on('shown.bs.modal', function (e) {
                                $("#proceeding-modal").modal("hide");
                            })
                        }
                        console.log("Added"); console.log(addedObj);
                        return true;
                    },
                }
            }

            $("#tree").BsNestedSortable(input)//.serializeList()

        })
    </script>
    <p>catObj <textarea id="catObj" cols="130"></textarea> </p><input type="text" id="catObj2" style="width: 110rem;">
    </div>

    <p>parentArr <input type="text" id="parentArr" style="width: 110rem;"></div>
    </p>
    <p>childrenArr <input type="text" id="childrenArr" style="width: 110rem;"></div>
    </p>
    <p>hierarchy <input type="text" id="hierarchy" style="width: 110rem;"></div>
    </p>
    <p>hierarchyMin <input type="text" id="minHierarchy" style="width: 110rem;"></div>
    </p>

    <p>allParentsArr <input type="text" id="allParentsArr" style="width: 110rem;"></div>
    </p>
    <p>allChildrenArr <input type="text" id="allChildrenArr" style="width: 110rem;"></div>
    </p>
    <div class="modal fade" id="proceeding-error" tabindex="-1" role="dialog" aria-labelledby="myEroorLabel">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content bg-danger text-white">
                <div class="modal-body text-center">
                    <h3 class="text-white mb-15" id="myEroorLabel"><i class="fa fa-exclamation-triangle"></i> ERROR!
                    </h3>
                    <span>proceeding Failed.</span>
                    <p><div id="errorDesc"></div></p>
                    <p></p>
                    <button type="button" class="btn btn-light close" data-dismiss="modal"
                        data-bs-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal hide fade" id="proceeding-modal">
        <div class="modal-dialog modal-dialog-centered " role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="loader">
                        <div class="fa-3x">
                            <i class="fas fa-circle-notch fa-spin" style="color:blue ;"></i>

                        </div>
                    </div>
                    <div class="loader-txt" id="proceedingLabel">
                        <p>Please wait while the server is proceeding.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Custom sized Modal</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" data-dismiss="modal"
                        aria-label="Close"><i class="bi bi-x-lg"></i></button>
                </div>
                <div class="modal-body">
                    <div id="test"></div>
                    <input type="hidden" id="parentOfThis" />
                    <input type="hidden" id="IsAddItem" />
                    <input type="hidden" id="oldNameOfBranch" />
                    <input type="hidden" id="oldImgName" />
                    <div class="form-group">

                        <input type="text" class="form-control validate[required,minSize[2],maxSize[20]]" id="CatName"
                            placeholder="Item name" data-prompt-position="topLeft">
                    </div>
                    <div class="form-group">
                        <textarea class="summernote" name="CatDesc" id="CatDescId"
                            style="min-width: 100%;height: 10rem;" placeholder="Item description"></textarea>
                    </div>
                    <div class="form-group">
                        <div style="max-height: 2rem;" id="uploadedImage"></div>
                        <div class="input-group">
                            <div class="custom-file">
                                <div class="branch-leftdivImage" id="uploadedImage"></div>
                                <input type="text" class="form-control" id="image" placeholder="Item image"
                                    data-prompt-position="topLeft">

                            </div>

                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn btn-primary submit" data-dismiss="modal"
                        data-bs-dismiss="modal">OK</button>
                    <button type="button" class="btn btn-orange close" data-dismiss="modal"
                        data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal HTML -->
    <div id="myModalDelete" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmation</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="IdOfDelete" />
                    <div class="text-center fs-1"><i class="bi bi-x-octagon" style="color:red"></i></div>
                    <p>Do you want to delete This Branch?</p>
                    <p class="text-secondary"><small>If you don't save, your changes will be lost.</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close" data-dismiss="modal"
                        data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary Delete">Delete</button>
                </div>
            </div>
        </div>
    </div>


</body>

</html>