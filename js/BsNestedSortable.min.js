/**
 * Bootstrap Nested sortable tree.
 *
 * @package BsNestedSortable
 * @copyright MIT
 * @license https://github.com/karamelikli/BsNestedSortable/blob/main/LICENSE
 * @version 1.3.5
 * @link https://github.com/karamelikli/BsNestedSortable
 * minified by https://github.com/mishoo/UglifyJS
 */
 

 function BsNestedSortable(){var initialSerilized,UInestedSortable={options:{depth:30,treeSelector:"#tree",branchSelector:".tree-branch",branchPathSelector:".branch-path",dragHandlerSelector:".moveAble",placeholderName:"sortable-placeholder",childrenBusSelector:".children-bus",collapseChildren:".collapseChildren",levelPrefix:"branch-level",maxHeight:40,minHeight:10,insertNewButton:'<button type="button" class="btn btn-primary btn-lg btn-block w-100">Insert New Branch</button>',imagesUrlPrefix:"",icons:{remove:'<i class="far fa-trash-alt"></i>',edit:'<i class="far fa-edit"></i>',add:'<i class="far fa-plus-square"></i>',expand:'<i class="fas fa-plus"></i>',collapse:'<i class="fas fa-minus"></i>'},modal:{id:"#myModal",ModalDelete:"#myModalDelete",name:"#CatName",description:"#CatDescId",image:"#image"},maxLevel:3,rootID:0,dataAttributes:{id:"id",parent:"parent",title:"title"},dataKeys:{id:"id",parent:"parent_id",title:"title",description:"description",image:"img"}},serializeOption:{serializeON:!1,method:"JSON",call:"html",outPuts:{catObj:"#catObj",parentArr:"#parentArr",childrenArr:"#childrenArr",Hierarchy:"#hierarchy",minHierarchy:"#minHierarchy",allParentsArr:"#allParentsArr",allChildrenArr:"#allChildrenArr"}},eventsOptions:{onComplete:function(){},onDelete:function(){},onEdit:function(){},onAdd:function(){},excludedObjElms:[]},run(){this.jQuerySupplements(),this.initSorting(),!0===this.serializeOption.serializeON&&(initialSerilized=this.serialization().catObj)},mapTheData(e){return e.map(this.createBranch)},prepareData(e){const{options:{dataKeys:{id:t,parent:n,title:a,description:i,image:l},rootID:r,maxLevel:s}}=UInestedSortable;Object.keys(e).forEach(function(t,s){void 0===e[t][i]&&(e[t][i]=""),void 0===e[t][l]&&(e[t][l]=""),void 0===e[t][a]&&(e[t][a]="temp title"),void 0===e[t][n]&&(e[t][n]=r)});let o=[];const c=[],h=function(a){const i=e.filter(e=>e[n]==a);if(i.length>0)$.each(i,function(a,i){const l=i[t],d=i[n];let p=e.find(e=>e[t]==l),u=1;if(d!=r){let e=o.filter(e=>e[t]==d)[0];(u=e.level+1)>s&&(u=s,p[n]=e[n])}c[l]=u,p.level=u,o=o.concat(p),e.filter(e=>e[n]==l).length>0&&h(l)});else{let n=1;a!=r&&(n=c[a]+1),c[ThisId]=n;let i=e.find(e=>e[t]==a);i.level=n,o=o.concat(i)}};return h(r),o},MakeContents(e){const{options:{treeSelector:t,insertNewButton:n,rootID:a,modal:i}}=UInestedSortable;if(!(e.length<1||"number"!=typeof e.length))return this.mapTheData(this.prepareData(e));$(t).before($(n).addClass("emptyButton").click(function(){$("#parentOfThis").val(a),$("#IsAddItem").val(!0),$(i.id).modal("show")}))},html(e,t){$(e).html(this.MakeContents(t)),this.run()},getDistance(e,t){const n=e.getBoundingClientRect(),a=t.getBoundingClientRect();return{distanceX:Math.floor(Math.abs(n.left+n.width/2-(a.left+a.width/2))),distanceY:Math.floor(Math.abs(n.top+n.height/2-(a.top+a.height/2)))}},getSerialDiff(){const{options:{dataKeys:{id:e,parent:t,title:n,image:a,description:i}},serializeOption:{serializeON:l},eventsOptions:{excludedObjElms:r},serialize:s}=UInestedSortable;if(0==l)return;let o=initialSerilized,c=s().catObj,h=[],d=[],p=[];return o!=c&&(o.map(function(t){const n=c.filter(n=>n[e]==t[e]);if(n.length>0){const e=n[0];for(var a in t){if(void 0===t[a]||void 0===e[a]){p.push("undefined"==t[a]?e:t);break}if(t[a]!==e[a]&&!r.includes(a)){if(!Array.isArray(t[a])){p.push(e);break}if(JSON.stringify(t[a].sort())!==JSON.stringify(e[a].sort())){p.push(e);break}}}}else h.push(t)}),c.map(function(t){0==o.filter(n=>n[e]==t[e]).length&&d.push(t)}),{deleted:h,added:d,modified:p,theLastSerializ:c})},serialization(){const{options:{dataAttributes:e,treeSelector:t,rootID:n,dataKeys:a}}=UInestedSortable,i={},l={},r={},s={[n]:[]},o=[],c=function(t,n){let a=t.getParent(),i=a.attr("data-"+e.id);void 0!==i&&(r[n].push(i),void 0!==s[i]?s[i].push(n):Object.assign(s,{[i]:[n]})),a.length&&a.getParent().length&&c(a,n)},h=function(e,t="typeof"){return"typeof"==t?void 0===e?[]:e:"text"==t?void 0===e?"":e:void 0};$(t+" li").each(function(){theID=$(this).attr("data-"+e.id),Object.assign(r,{[theID]:[n]}),s[n].push(theID);const t=$(this).attr("data-"+e.parent);Object.assign(l,{[theID]:[t]}),void 0===i[t]?Object.assign(i,{[t]:[theID]}):i[t].push(theID),c($(this),theID)}),o[n]={[a.id]:n,[a.parent]:"",level:0,[a.title]:"Root",parents:[],children:[],[a.image]:"",[a.description]:""},$(t+" li").each(function(){theID=$(this).attr("data-"+e.id),o[theID]={[a.id]:theID,[a.parent]:$(this).attr("data-"+e.parent),level:$(this).attr("data-level"),[a.title]:h($(this).find(".branch-title").html(),"text"),[a.image]:h($(this).find(".branch-leftdivImage img").attr("src"),"text"),[a.description]:h($(this).find(".desc.d-none").html(),"text"),parents:h(r[theID]),children:h(s[theID])}});const d=function(e){const t={[a.id]:e,[a.title]:o[e].text,[a.parent]:o[e].parent,parents:o[e].parents,level:o[e].level,[a.image]:o[e].image,[a.description]:o[e].description,children:[]},n={[a.id]:e,[a.title]:o[e].text};return void 0!==i[e]&&i[e].length&&$.each(i[e],function(e,a){const i=d(a);t.children.push(i.Hierarchy),void 0===n.children&&(n.children=[]),n.children.push(i.minHierarchy)}),{Hierarchy:t,minHierarchy:n}},p=d(n),u=p.Hierarchy,g=p.minHierarchy;return{catObj:o,parentArr:l,childrenArr:i,minHierarchy:g,Hierarchy:u,allParentsArr:r,allChildrenArr:s}},serialize(){const{serializeOption:{method:method,outPuts:outPuts,serializeON:serializeON,call:call},serialization:serialization}=UInestedSortable;if(0==serializeON)return;const serobjs=serialization();if(void 0!==outPuts)for(const[key,value]of Object.entries(outPuts))for(const[key2,value2]of Object.entries(serobjs))if(key==key2)switch(method){case"JSON":const newOutput=JSON.stringify(value2);"html"==call&&$(value).html(newOutput),"val"==call&&$(value).val(newOutput),"text"==call&&$(value).text(newOutput);break;case"console":console.log(value),console.log(value2);break;case"alert":alert(value),alert(value2);break;case"asVar":const tempVar=value2;eval("globalThis."+key+"=tempVar")}return serobjs},cleanSelector:e=>e.replace(/^[\.#]/g,""),getInstance(){return this},getTreeEdge:()=>$(UInestedSortable.options.treeSelector).offset().left,pxToNumber:e=>new RegExp("px$","i").test(e)?1*e.slice(0,-2):0,numberToPx:e=>`${e}px`,generateNewId(){const{options:{treeSelector:e,branchSelector:t,dataAttributes:{id:n}}}=UInestedSortable,a=[];return $(e+" "+t).map(function(){const e=$(this).attr("data-"+n);Number(e)==e&&a.push(Number(e))}),0==a.length?1:Math.max.apply(null,a)+1},createBranch(e){const{options:{branchSelector:t,branchPathSelector:n,childrenBusSelector:a,levelPrefix:i,collapseChildren:l,icons:{add:r,edit:s,remove:o},dataKeys:{id:c,parent:h,title:d,description:p,image:u},dataAttributes:{id:g,parent:$},imagesUrlPrefix:f},cleanSelector:v}=UInestedSortable,{[c]:m,level:b,[h]:S,[d]:x,[u]:I}=e;let{[p]:B}=e,y="";B?(y=B.replace(/(<([^>]+)>)/gi,""),B=B.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")):y=B="";const O=I?"<img src='"+f+I+"' />":"";return`\n                    <li class="${v(t)} ${i}-${b}" data-${g}="${m}" data-${$}="${S}" data-level="${b}">            \n                                    <span class="${v(n)}"></span>\n                        <div class=" moveAble  branch-wrapper" >\n                            <div   class="branch-leftdiv">                             \n                                <button type="button"  class="button ${v(l)} " ></button>                           \n                                <div  class="branch-leftdivImage">${O}</div>\n                                <span class="branch-title">${x}</span> \n                            </div>   \n                            <div class="branch-desc">${y}</div>\n                            <div class="desc d-none" style="display:none"  >${B}</div>\n                            <div class ="iconsDiv">\n                                <button type="button" class="button edit-Icon" title="Edit Branch">${s}</button>\n                                <button type="button" class="button add-Icon" title="Add a new child">${r}</button>\n                                <button type="button" class="button delete-Icon" title="Remove Branch">${o}</button>\n                            </div>                  \n                        </div>             \n                        <div class="${v(a)}"></div>\n                    </li>\n                `},jQuerySupplements(){const{options:e}=UInestedSortable,{levelPrefix:t}=e;$.fn.extend({getBranchLevel(){if(0===$(this).length)return 0;const{depth:t}=e,n=$(this).css("margin-left");return/(px)|(em)|(rem)$/i.test(n)?Math.floor(n.slice(0,-2)/t)+1:Math.floor(n/t)+1},updateBranchLevel(e,n=null){return this.each(function(){n=n||$(this).getBranchLevel()||1,$(this).removeClass(t+"-"+n).addClass(t+"-"+e).data("level",e).attr("data-level",e)})},shiftBranchLevel(e){return this.each(function(){let n=$(this).getBranchLevel()||1,a=n+e;$(this).removeClass(t+"-"+n).addClass(t+"-"+a).data("level",a).attr("data-level",a)})},getParent(){const{options:{branchSelector:e}}=UInestedSortable,t=$(this).getBranchLevel()||1;let n=$(this).prev(e);for(;n.length&&n.getBranchLevel()>=t;)n=n.prev(e);return n},getRootChild(){const{options:{branchSelector:e,treeSelector:t,levelPrefix:n}}=UInestedSortable;return $(t).children(`${e}.${n}-1`)},getLastChild(){const e=$(this).getChildren(),t=$(this).getDescendants(),n=t.length>e.length?t.last():e.last();return n.length?n:$()},getChildren(){const{options:{branchSelector:e}}=UInestedSortable;let t=$();return this.each(function(){let n=$(this).getBranchLevel()||1,a=$(this).next(e);for(;a.length&&a.getBranchLevel()>n;)a.getBranchLevel()===n+1&&(t=t.add(a)),a=a.next(e)}),t},getDescendants(){const{options:{branchSelector:e}}=UInestedSortable;let t=$();return this.each(function(){let n=$(this).getBranchLevel()||1,a=$(this).next(e);for(;a.length&&a.getBranchLevel()>n;)t=t.add(a),a=a.next(e)}),t},nextBranch(){return $(this).next()},prevBranch(){return $(this).prev()},nextSibling(){const{options:{branchSelector:e}}=UInestedSortable;let t=$(this).getBranchLevel()||1,n=$(this).next(e),a=n.getBranchLevel();for(;n.length&&a>t;)a=(n=n.next(e)).getBranchLevel();return+a==+t?n:$()},prevSibling(){const{options:{branchSelector:e}}=UInestedSortable;let t=$(this).getBranchLevel()||1,n=$(this).prev(e),a=n.getBranchLevel();for(;n.length&&a>t;)a=(n=n.prev(e)).getBranchLevel();return a===t?n:$()},getLastSibling(){let e=$(this).nextSibling();if(!e.length)return $(this);for(;e.length;){const t=e.nextSibling();if(!t.length)return e;e=t}},getSiblings(e=null){const{options:{treeSelector:t,branchSelector:n}}=UInestedSortable;e=e||$(this).getBranchLevel();let a=[],i=$(`${t} > ${n}`),l=this;return i.length&&i.each(function(){+$(this).getBranchLevel()==+e&&l[0]!==$(this)[0]&&a.push($(this))}),a},addIcons(){const{options:{branchSelector:e,collapseChildren:t,icons:{collapse:n}}}=UInestedSortable;$(e).each(function(){$(this).getChildren().length&&$(this).find(t).html(n)})},calculateSiblingDistances(){const{options:{maxHeight:e,minHeight:t,branchSelector:n,branchPathSelector:a},getDistance:i}=UInestedSortable;$(n).each(function(){const l=$(this).getBranchLevel()||1;if($(this).find(a).show(),"function"==typeof $(this).nextSibling)if(l>1){const s=$(this).nextSibling();if(s.length){const n=i($(this).get(0),s.get(0));var r=$(this).getParent()?$(this).getParent():$(this).getRootChild();const l=i($(this).get(0),r.get(0));s.find(a).css("height",`${Math.max(n.distanceY+t,e)}px`),$(this).find(a).css("height",`${Math.max(l.distanceY+t,e)}px`)}else{const i=$(this).next(n),r=i.getBranchLevel()||1;i.length>0&&r>l&&i.find(a).css("height",e+"px"),i.length>0&&r<l&&($(this).prevBranch().getBranchLevel()<l&&$(this).find(a).css("height",e+t+"px"),$(this).prevBranch().getBranchLevel()==l&&$(this).find(a).css("height",e+e+"px")),$(this).prevBranch().getBranchLevel()<l&&$(this).find(a).css("height",e+t+"px")}}else $(this).find(a).hide()})},removeBranch(){const{options:{treeSelector:e,branchSelector:t},updateBranchZIndex:n}=UInestedSortable,a=$(this).closest(`${e} ${t}`);$descendants=a.getDescendants(),$descendants.each((e,t)=>{$(t).remove()}),a.remove(),n(),serialize()},collapseThis(e=!1){const{options:{treeSelector:t,branchSelector:n,icons:{collapse:a,expand:i}}}=UInestedSortable,l=$(this).closest(`${t} ${n}`),r=l.find(".collapseChildren");r.hasClass("expandIcon")?e||r.removeClass("expandIcon").addClass("collapseIcon").html(a):e||r.removeClass("collapseIcon").addClass("expandIcon").html(i);const s=l.getChildren().is(":visible");e||(s?l.attr("data-collapsed","hide"):l.attr("data-collapsed","show")),l.getChildren().each(function(){s?($(this).hide(),e||l.attr("data-visibility","hide")):($(this).show(),e||l.attr("data-visibility","show")),$(this).getChildren().length&&$(this).getChildren().is(":visible")==s&&"hide"!=$(this).attr("data-visibility")&&$(this).collapseThis(!0)})},updateCollapse(){const{options:{icons:{expand:e}}}=UInestedSortable,t=$(this).find(".collapseChildren");"hide"==$(this).attr("data-collapsed")&&(t.removeClass("collapseIcon").addClass("expandIcon").html(e),console.log(t))}})},updateBranchZIndex(){const{options:{treeSelector:e,branchSelector:t}}=UInestedSortable,n=$(`${e} > ${t}`),a=n.length;n.length&&n.each(function(e){$(this).css("z-index",Math.max(1,a-e))})},initSorting(){const{options:e,eventsOptions:t,pxToNumber:n,numberToPx:a,updateBranchZIndex:i,serialize:l,getSerialDiff:r,generateNewId:s,createBranch:o}=UInestedSortable,{treeSelector:c,dragHandlerSelector:h,placeholderName:d,childrenBusSelector:p,branchPathSelector:u,branchSelector:g,levelPrefix:f,dataAttributes:v,collapseChildren:m,modal:b,maxLevel:S,dataKeys:{id:x,parent:I,title:B,description:y,image:O}}=e;i();let D=1,C=1,L=null,w=0,z=0;$(this).addIcons(),$(document).on("click",m,function(){$(this).collapseThis(),$(this).calculateSiblingDistances()}),$(document).on("click",".delete-Icon",function(){$(b.ModalDelete+" #IdOfDelete").val($(this).parents(g).attr("data-"+v.id)),$(b.ModalDelete).modal("show")}),$(b.ModalDelete+" .Delete").on("click",function(){const e=$(b.ModalDelete+" #IdOfDelete").val(),n=$(c+" [data-"+v.id+'="'+e+'"]');if(0==n.getDescendants().length){n.remove(),$(c).calculateSiblingDistances(),i();const e=r();t.onDelete(n,e)}else $("#myModalDeleteAlert").modal("show");$(b.ModalDelete+" .close").click()}),$(document).on("click",".add-Icon,.edit-Icon",function(){const e=$(this).parents(g),t=e.attr("data-"+v.id);if(!$(this).hasClass("add-Icon")){const t=e.find(".branch-title").text(),n=e.find(".branch-leftdivImage img").attr("src"),a=e.find(".desc.d-none").html().replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");$(b.name).val(t),$(b.description).val(a),$(b.image).val(n)}$("#parentOfThis").val(t),$("#IsAddItem").val($(this).hasClass("add-Icon")),$(b.id).modal("show")}),$(b.id+" .close").on("click",function(){$(b.name).val(""),$(b.description).val(""),$(b.image).val(""),$("#parentOfThis").val(""),$(b.id).modal("hide")}),$(b.id+" .submit").on("click",function(){const e=$("#IsAddItem").val(),n=$("#parentOfThis").val(),a=$("*[data-"+v.id+'="'+n+'"]'),l=$(b.name).val()?$(b.name).val():"New Item",h=$(b.description).val(),d=$(b.image).val();if("true"==e){var p=s();const e=$("#parentOfThis").val(),t=Math.min(S,parseInt(a.getBranchLevel())+1);$lastChild=a.getLastChild();const n=o({[x]:p,[I]:e,[B]:l,level:t,[y]:h,[O]:d});$lastChild.length?$lastChild.after(n):a.length?a.after(n):($(c).html(n),$(".emptyButton").remove()),$(c).addIcons(),$(c).calculateSiblingDistances(),i()}else a.find(".branch-title").text(l),a.find(".desc.d-none").html(h),a.find(".branch-desc").html(h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),a.find(".branch-leftdivImage img").attr("src",d);$(b.id+" .close").click();const u=r();"true"==e?t.onAdd($("*[data-"+v.id+'="'+p+'"]'),u):t.onEdit(a,u)}),$(this).calculateSiblingDistances();l(),$(c).sortable({handle:h,placeholder:d,items:"> *",start(e,t){const i=t.item.getBranchLevel();t.placeholder.updateBranchLevel(i),z=t.item.index(),C=i,(L=t.item.find(p)).append(t.item.next().getDescendants());let l=L.outerHeight(),r=t.placeholder.css("margin-top");l+=l>0?n(r):0,l+=t.helper.outerHeight(),w=l,l-=2;let s=t.helper.find(g).outerWidth()-2;t.placeholder.css({height:l,width:s});const o=t.placeholder.nextBranch();o.css("margin-top",a(w)),t.placeholder.detach(),$(this).sortable("refresh"),t.item.after(t.placeholder),o.css("margin-top",0),D=i,$(`${c} ${g} ${u}`).hide()},sort(e,t){const{options:n,getTreeEdge:a}=UInestedSortable,{depth:i,maxLevel:l}=n;let r=a(),s=t.helper.offset().left,o=1,c=l,h=t.placeholder.prevBranch(),d=(h=h[0]===t.item[0]?h.prevBranch():h).getBranchLevel();c=Math.min(d+1,l);let p=1;if(t.placeholder.nextSibling().length)p=t.placeholder.getBranchLevel()||1;else{p=t.placeholder.nextBranch().getBranchLevel()||1}o=Math.max(1,p);let u=Math.max(0,s-r),g=Math.floor(u/i)+1;if(g=Math.max(o,Math.min(g,c)),(e=>{let t=e.helper.offset().top+w,n=e.placeholder.nextBranch(),a=n.offset()||0,i=n.outerHeight();return t>a.top+i/3})(t)){let e=t.placeholder.nextBranch();e.getDescendants().length&&(g=e.getBranchLevel()+1),e.after(t.placeholder),$(this).sortable("refreshPositions")}var f,v;f=t.placeholder,v=g,f.updateBranchLevel(v),D=v},change(e,t){let n=t.placeholder.prevBranch(),a=(n=n[0]===t.item[0]?n.prevBranch():n).getBranchLevel()||1;if(n.length){t.placeholder.detach();let e=n.getDescendants();e&&e.length&&(a+=1),t.placeholder.updateBranchLevel(a),n.after(t.placeholder)}},stop(e,n){$(`${g}:not(${f}-1) ${u}`).show();const a=L.children().insertAfter(n.item);L.empty(),0==n.item.next().getDescendants().length&&$(m).html(""),n.item.updateBranchLevel(D),a.shiftBranchLevel(D-C),$(this).addIcons(),i();const s=n.item.getParent();n.item.data(v.parent,s.data(v.id)).attr(`data-${v.parent}`,s.data(v.id)),l(),D===C&&z===n.item.index()||t.onComplete(n,r()),a.length>0&&(n.item.updateCollapse(),a.each(function(){$(this).updateCollapse()})),$(this).calculateSiblingDistances()}})}};return UInestedSortable}ajaxRequest=function(e,t,n){new Promise((t,n)=>{$.ajax({...e,...{success:function(e){t(e)},error:function(e,t){n(e,t)}}})}).then(e=>{t(e)}).catch((e,t)=>{n(e,t);let a="";a=0===e.status?"Not connect.\n Verify Network.":404==e.status?"Requested page not found. [404]":500==e.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+jqXHR.responseText,$("#errorDesc").html(a),$("#proceeding-error").modal("show")})},jQuery.fn.BsNestedSortable=function(e){data="object"==typeof e&&e.hasOwnProperty("data")?e.data:data;const t=new BsNestedSortable;let n="";return $(this[0]).attr("id")&&(n+="#"+$(this[0]).attr("id")),$(this[0]).attr("class")&&(n+="."+$.trim($(this[0]).attr("class")).replace(/\s/gi,".")),t.options={...t.options,...{treeSelector:n}},"object"==typeof e&&e.hasOwnProperty("options")&&(t.options={...t.options,...e.options}),$(this[0]).html(t.MakeContents(data)),"object"==typeof e&&void 0!==e.serializeOption&&(t.serializeOption={...t.serializeOption,...e.serializeOption,...{serializeON:!0}}),"object"==typeof e&&void 0!==e.eventsOptions&&(t.serializeOption={...t.serializeOption,...{serializeON:!0}},t.eventsOptions={...t.eventsOptions,...e.eventsOptions}),t.run(),this};