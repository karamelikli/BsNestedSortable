/**
 * Bootstrap Nested sortable tree.
 *
 * @package BsNestedSortable
 * @license MIT
 * @version 1.3.1
 * @author Huseyin Karamelikli <hakperest@gmail.com>
 */
 function BsNestedSortable(){var initialSerilized,UInestedSortable={options:{depth:30,treeSelector:"#tree",branchSelector:".tree-branch",branchPathSelector:".branch-path",dragHandlerSelector:".moveAble",placeholderName:"sortable-placeholder",childrenBusSelector:".children-bus",collapseChildren:".collapseChildren",levelPrefix:"branch-level",insertNewButton:'<button type="button" class="btn btn-primary btn-lg btn-block w-100">Insert New Branch</button>',imagesUrlPrefix:"",icons:{tag:"i",remove:'<i class="far fa-trash-alt"></i>',edit:'<i class="far fa-edit"></i>',add:'<i class="far fa-plus-square"></i>',Class:"fas",expand:"fa-plus",collapse:"fa-minus"},modal:{id:"#myModal",ModalDelete:"#myModalDelete",name:"#CatName",description:"#CatDescId",image:"#image"},maxLevel:3,rootID:0,dataAttributes:{id:"id",parent:"parent",title:"title"},dataKeys:{id:"id",parent:"parent_id",title:"title",description:"description",image:"img"}},serializeOption:{serialize:!1,method:"JSON",call:"html"},eventsOptions:{onComplete:function(){},onDelete:function(){},onEdit:function(){},onAdd:function(){},excludedObjElms:[]},run(){this.jQuerySupplements(),this.initSorting(),!0===this.serializeOption.serialize&&(initialSerilized=this.serialization().catObj)},mapTheData(e){return e.map(this.createBranch)},prepareData(e){const{options:{dataKeys:{id:t,parent:n,title:i,description:a,image:l},rootID:s,maxLevel:r}}=UInestedSortable;Object.keys(e).forEach(function(t,r){void 0===e[t][a]&&(e[t][a]=""),void 0===e[t][l]&&(e[t][l]=""),void 0===e[t][i]&&(e[t][i]="temp title"),void 0===e[t][n]&&(e[t][n]=s)});let o=[];const c=[],h=function(i){const a=e.filter(e=>e[n]==i);if(a.length>0)$.each(a,function(i,a){const l=a[t],d=a[n];let p=e.find(e=>e[t]==l),g=1;if(d!=s){let e=o.filter(e=>e[t]==d)[0];(g=e.level+1)>r&&(g=r,p[n]=e[n])}c[l]=g,p.level=g,o=o.concat(p),e.filter(e=>e[n]==l).length>0&&h(l)});else{let n=1;i!=s&&(n=c[i]+1),c[ThisId]=n;let a=e.find(e=>e[t]==i);a.level=n,o=o.concat(a)}};return h(s),o},MakeContents(e){const{options:{treeSelector:t,insertNewButton:n,rootID:i,modal:a}}=UInestedSortable;if(!(e.length<1||"number"!=typeof e.length))return this.mapTheData(this.prepareData(e));$(t).before($(n).addClass("emptyButton").click(function(){$("#parentOfThis").val(i),$("#IsAddItem").val(!0),$(a.id).modal("show")}))},html(e,t){$(e).html(this.MakeContents(t)),this.run()},getDistance(e,t){const n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{distanceX:Math.floor(Math.abs(n.left+n.width/2-(i.left+i.width/2))),distanceY:Math.floor(Math.abs(n.top+n.height/2-(i.top+i.height/2)))}},getSerialDiff(){const{options:{dataKeys:{id:e,parent:t,title:n,image:i,description:a}},eventsOptions:{excludedObjElms:l},serialize:s}=UInestedSortable;let r=initialSerilized,o=s().catObj,c=[],h=[],d=[];return r!=o&&(r.map(function(t){const n=o.filter(n=>n[e]==t[e]);if(n.length>0){const e=n[0];for(var i in t){if(void 0===t[i]||void 0===e[i]){d.push("undefined"==t[i]?e:t);break}if(t[i]!==e[i]&&!l.includes(i)){if(!Array.isArray(t[i])){d.push(e);break}if(JSON.stringify(t[i].sort())!==JSON.stringify(e[i].sort())){d.push(e);break}}}}else c.push(t)}),o.map(function(t){0==r.filter(n=>n[e]==t[e]).length&&h.push(t)}),{deleted:c,added:h,modified:d,theLastSerializ:o})},serialization(){const{options:{dataAttributes:e,treeSelector:t,rootID:n,dataKeys:i}}=UInestedSortable,a={},l={},s={},r={[n]:[]},o=[],c=function(t,n){let i=t.getParent(),a=i.attr("data-"+e.id);void 0!==a&&(s[n].push(a),void 0!==r[a]?r[a].push(n):Object.assign(r,{[a]:[n]})),i.length&&i.getParent().length&&c(i,n)},h=function(e,t="typeof"){return"typeof"==t?void 0===e?[]:e:"text"==t?void 0===e?"":e:void 0};$(t+" li").each(function(){idisi=$(this).attr("data-"+e.id),Object.assign(s,{[idisi]:[n]}),r[n].push(idisi);const t=$(this).attr("data-"+e.parent);Object.assign(l,{[idisi]:[t]}),void 0===a[t]?Object.assign(a,{[t]:[idisi]}):a[t].push(idisi),c($(this),idisi)}),o[n]={[i.id]:n,[i.parent]:"",level:0,[i.title]:"Root",parents:[],children:[],[i.image]:"",[i.description]:""},$(t+" li").each(function(){idisi=$(this).attr("data-"+e.id),o[idisi]={[i.id]:idisi,[i.parent]:$(this).attr("data-"+e.parent),level:$(this).attr("data-level"),[i.title]:h($(this).find(".branch-title").html(),"text"),[i.image]:h($(this).find(".branch-leftdivImage img").attr("src"),"text"),[i.description]:h($(this).find(".desc.d-none").html(),"text"),parents:h(s[idisi]),children:h(r[idisi])}});const d=function(e){const t={[i.id]:e,[i.title]:o[e].text,[i.parent]:o[e].parent,parents:o[e].parents,level:o[e].level,[i.image]:o[e].image,[i.description]:o[e].description,children:[]},n={[i.id]:e,[i.title]:o[e].text};return void 0!==a[e]&&a[e].length&&$.each(a[e],function(e,i){const a=d(i);t.children.push(a.Hierarchy),void 0===n.children&&(n.children=[]),n.children.push(a.minHierarchy)}),{Hierarchy:t,minHierarchy:n}},p=d(n),g=p.Hierarchy,u=p.minHierarchy;return{catObj:o,parentArr:l,childrenArr:a,minHierarchy:u,Hierarchy:g,allParentsArr:s,allChildrenArr:r}},serialize(){const{serializeOption:{method:method,outPuts:outPuts,serialize:serialize,call:call},serialization:serialization}=UInestedSortable;if(0==serialize)return;const serobjs=serialization();if(void 0!==outPuts)for(const[key,value]of Object.entries(outPuts))for(const[key2,value2]of Object.entries(serobjs))if(key==key2)switch(method){case"JSON":const newOutput=JSON.stringify(value2);"html"==call&&$(value).html(newOutput),"val"==call&&$(value).val(newOutput);break;case"console":console.log(value),console.log(value2);break;case"alert":alert(value),alert(value2);break;case"asVar":const tempVar=value2;eval("globalThis."+key+"=tempVar")}return serobjs},cleanSelector:e=>e.replace(/^[\.#]/g,""),getInstance(){return this},getTreeEdge:()=>$(UInestedSortable.options.treeSelector).offset().left,pxToNumber:e=>new RegExp("px$","i").test(e)?1*e.slice(0,-2):0,numberToPx:e=>`${e}px`,generateNewId(){const{options:{treeSelector:e,branchSelector:t,dataAttributes:{id:n}}}=UInestedSortable,i=[];return $(e+" "+t).map(function(){const e=$(this).attr("data-"+n);Number(e)==e&&i.push(Number(e))}),0==i.length?1:Math.max.apply(null,i)+1},createBranch(e){const{options:{branchSelector:t,branchPathSelector:n,childrenBusSelector:i,levelPrefix:a,collapseChildren:l,icons:{add:s,edit:r,remove:o},dataKeys:{id:c,parent:h,title:d,description:p,image:g},dataAttributes:{id:$,parent:u},imagesUrlPrefix:v},cleanSelector:f}=UInestedSortable,{[c]:m,level:b,[h]:S,[d]:x,[g]:B}=e;let{[p]:I}=e,C="";I?(C=I.replace(/(<([^>]+)>)/gi,""),I=I.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")):C=I="";const y=B?"<img src='"+v+B+"' />":"";return`\n                    <li class="${f(t)} ${a}-${b}" data-${$}="${m}" data-${u}="${S}" data-level="${b}">            \n                                    <span class="${f(n)}"></span>\n                        <div class=" moveAble  branch-wrapper" >\n                            <div   class="branch-leftdiv">                             \n                                <button type="button"  class="button ${f(l)} " ></button>                           \n                                <div  class="branch-leftdivImage">${y}</div>\n                                <span class="branch-title">${x}</span> \n                            </div>   \n                            <div class="branch-desc">${C}</div>\n                            <div class="desc d-none"   >${I}</div>\n                            <div class ="iconsDiv">\n                                <button type="button" class="button edit-Icon" title="Edit Branch">${r}</button>\n                                <button type="button" class="button add-Icon" title="Add a new child">${s}</button>\n                                <button type="button" class="button delete-Icon" title="Remove Branch">${o}</button>\n                            </div>                  \n                        </div>             \n                        <div class="${f(i)}"></div>\n                    </li>\n                `},jQuerySupplements(){const{options:e}=UInestedSortable,{levelPrefix:t}=e;$.fn.extend({getBranchLevel(){if(0===$(this).length)return 0;const{depth:t}=e,n=$(this).css("margin-left");return/(px)|(em)|(rem)$/i.test(n)?Math.floor(n.slice(0,-2)/t)+1:Math.floor(n/t)+1},updateBranchLevel(e,n=null){return this.each(function(){n=n||$(this).getBranchLevel()||1,$(this).removeClass(t+"-"+n).addClass(t+"-"+e).data("level",e).attr("data-level",e)})},shiftBranchLevel(e){return this.each(function(){let n=$(this).getBranchLevel()||1,i=n+e;$(this).removeClass(t+"-"+n).addClass(t+"-"+i).data(n,i).attr("data-level",i)})},getParent(){const{options:{branchSelector:e}}=UInestedSortable,t=$(this).getBranchLevel()||1;let n=$(this).prev(e);for(;n.length&&n.getBranchLevel()>=t;)n=n.prev(e);return n},getRootChild(){const{options:{branchSelector:e,treeSelector:t,levelPrefix:n}}=UInestedSortable;return $(t).children(`${e}.${n}-1`)},getLastChild(){const e=$(this).getChildren(),t=$(this).getDescendants(),n=t.length>e.length?t.last():e.last();return n.length?n:$()},getChildren(){const{options:{branchSelector:e}}=UInestedSortable;let t=$();return this.each(function(){let n=$(this).getBranchLevel()||1,i=$(this).next(e);for(;i.length&&i.getBranchLevel()>n;)i.getBranchLevel()===n+1&&(t=t.add(i)),i=i.next(e)}),t},getDescendants(){const{options:{branchSelector:e}}=UInestedSortable;let t=$();return this.each(function(){let n=$(this).getBranchLevel()||1,i=$(this).next(e);for(;i.length&&i.getBranchLevel()>n;)t=t.add(i),i=i.next(e)}),t},nextBranch(){return $(this).next()},prevBranch(){return $(this).prev()},nextSibling(){const{options:{branchSelector:e}}=UInestedSortable;let t=$(this).getBranchLevel()||1,n=$(this).next(e),i=n.getBranchLevel();for(;n.length&&i>t;)i=(n=n.next(e)).getBranchLevel();return+i==+t?n:$()},prevSibling(){const{options:{branchSelector:e}}=UInestedSortable;let t=$(this).getBranchLevel()||1,n=$(this).prev(e),i=n.getBranchLevel();for(;n.length&&i>t;)i=(n=n.prev(e)).getBranchLevel();return i===t?n:$()},getLastSibling(){let e=$(this).nextSibling();if(!e.length)return $(this);for(;e.length;){const t=e.nextSibling();if(!t.length)return e;e=t}},getSiblings(e=null){const{options:{treeSelector:t,branchSelector:n}}=UInestedSortable;e=e||$(this).getBranchLevel();let i=[],a=$(`${t} > ${n}`),l=this;return a.length&&a.each(function(){+$(this).getBranchLevel()==+e&&l[0]!==$(this)[0]&&i.push($(this))}),i},addIcons(){const{options:{branchSelector:e,collapseChildren:t,icons:{tag:n,Class:i,collapse:a}}}=UInestedSortable;$(e).each(function(){$(this).getChildren().length&&$(this).find(t).html("<"+n+' class="'+i+" "+a+'"></i>')})},calculateSiblingDistances(){const{options:{branchSelector:e,branchPathSelector:t},getDistance:n}=UInestedSortable;$(e).each(function(){const i=$(this).getBranchLevel()||1;if($(this).find(t).show(),"function"==typeof $(this).nextSibling)if(i>1){const l=$(this).nextSibling();if(l.length){const e=n($(this).get(0),l.get(0));var a=$(this).getParent()?$(this).getParent():$(this).getRootChild();const i=n($(this).get(0),a.get(0));l.find(t).css("height",`${Math.max(e.distanceY+15,55)}px`),$(this).find(t).css("height",`${Math.max(i.distanceY+15,55)}px`)}else{const n=$(this).next(e),a=n.getBranchLevel()||1;n.length>0&&a>i&&n.find(t).css("height","55px"),n.length>0&&a<i&&$(this).prevBranch().getBranchLevel()<=i&&$(this).find(t).css("height","85px"),$(this).prevBranch().getBranchLevel()<i&&$(this).find(t).css("height","85px")}}else $(this).find(t).hide()})},removeBranch(){const{options:{treeSelector:e,branchSelector:t},updateBranchZIndex:n}=UInestedSortable,i=$(this).closest(`${e} ${t}`);$descendants=i.getDescendants(),$descendants.each((e,t)=>{$(t).remove()}),i.remove(),n(),serialize()},collapseThis(e=!1){const{options:{treeSelector:t,branchSelector:n,icons:{collapse:i,expand:a,Class:l}}}=UInestedSortable,s=$(this).closest(`${t} ${n}`),r=s.find(".collapseChildren ."+l);r.hasClass(a)?e||r.removeClass(a).addClass(i):e||r.removeClass(i).addClass(a);const o=s.getChildren().is(":visible");e||(o?s.attr("data-collapsed","hide"):s.attr("data-collapsed","show")),s.getChildren().each(function(){o?($(this).hide(),e||s.attr("data-visibility","hide")):($(this).show(),e||s.attr("data-visibility","show")),$(this).getChildren().length&&$(this).getChildren().is(":visible")==o&&"hide"!=$(this).attr("data-visibility")&&$(this).collapseThis(!0)})},updateCollapse(){const{options:{icons:{collapse:e,expand:t,Class:n}}}=UInestedSortable,i=$(this).find(".collapseChildren ."+n);"hide"==$(this).attr("data-collapsed")&&i.removeClass(e).addClass(t)}})},updateBranchZIndex(){const{options:{treeSelector:e,branchSelector:t}}=UInestedSortable,n=$(`${e} > ${t}`),i=n.length;n.length&&n.each(function(e){$(this).css("z-index",Math.max(1,i-e))})},initSorting(){const{options:e,eventsOptions:t,pxToNumber:n,numberToPx:i,updateBranchZIndex:a,serialize:l,getSerialDiff:s,generateNewId:r,createBranch:o}=UInestedSortable,{treeSelector:c,dragHandlerSelector:h,placeholderName:d,childrenBusSelector:p,branchPathSelector:g,branchSelector:u,levelPrefix:v,dataAttributes:f,collapseChildren:m,modal:b,maxLevel:S,dataKeys:{id:x,parent:B,title:I,description:C,image:y}}=e;a();let L=1,O=1,D=null,z=0,w=0;$(this).addIcons(),$(document).on("click",m,function(){$(this).collapseThis(),$(this).calculateSiblingDistances()}),$(document).on("click",".delete-Icon",function(){$(b.ModalDelete+" #IdOfDelete").val($(this).parents(u).attr("data-"+f.id)),$(b.ModalDelete).modal("show")}),$(b.ModalDelete+" .Delete").on("click",function(){const e=$(b.ModalDelete+" #IdOfDelete").val(),n=$(c+" [data-"+f.id+'="'+e+'"]');if(0==n.getDescendants().length){n.remove(),$(c).calculateSiblingDistances(),a();const e=s();t.onDelete(n,e)}else $("#myModalDeleteAlert").modal("show");$(b.ModalDelete+" .close").click()}),$(document).on("click",".add-Icon,.edit-Icon",function(){const e=$(this).parents(u),t=e.attr("data-"+f.id);if(!$(this).hasClass("add-Icon")){const t=e.find(".branch-title").text(),n=e.find(".branch-leftdivImage img").attr("src"),i=e.find(".desc.d-none").html().replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");$(b.name).val(t),$(b.description).val(i),$(b.image).val(n)}$("#parentOfThis").val(t),$("#IsAddItem").val($(this).hasClass("add-Icon")),$(b.id).modal("show")}),$(b.id+" .close").on("click",function(){$(b.name).val(""),$(b.description).val(""),$(b.image).val(""),$("#parentOfThis").val(""),$(b.id).modal("hide")}),$(b.id+" .submit").on("click",function(){const e=$("#IsAddItem").val(),n=$("#parentOfThis").val(),i=$("*[data-"+f.id+'="'+n+'"]'),l=$(b.name).val()?$(b.name).val():"New Item",h=$(b.description).val(),d=$(b.image).val();if("true"==e){var p=r();const e=$("#parentOfThis").val(),t=Math.min(S,parseInt(i.getBranchLevel())+1);$lastChild=i.getLastChild();const n=o({[x]:p,[B]:e,[I]:l,level:t,[C]:h,[y]:d});$lastChild.length?$lastChild.after(n):i.length?i.after(n):($(c).html(n),$(".emptyButton").remove()),$(c).addIcons(),$(c).calculateSiblingDistances(),a()}else i.find(".branch-title").text(l),i.find(".desc.d-none").html(h),i.find(".branch-desc").html(h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i.find(".branch-leftdivImage img").attr("src",d);$(b.id+" .close").click();const g=s();"true"==e?t.onAdd($("*[data-"+f.id+'="'+p+'"]'),g):t.onEdit(i,g)}),$(this).calculateSiblingDistances();l(),$(c).sortable({handle:h,placeholder:d,items:"> *",start(e,t){const a=t.item.getBranchLevel();t.placeholder.updateBranchLevel(a),w=t.item.index(),O=a,(D=t.item.find(p)).append(t.item.next().getDescendants());let l=D.outerHeight(),s=t.placeholder.css("margin-top");l+=l>0?n(s):0,l+=t.helper.outerHeight(),z=l,l-=2;let r=t.helper.find(u).outerWidth()-2;t.placeholder.css({height:l,width:r});const o=t.placeholder.nextBranch();o.css("margin-top",i(z)),t.placeholder.detach(),$(this).sortable("refresh"),t.item.after(t.placeholder),o.css("margin-top",0),L=a,$(`${c} ${u} ${g}`).hide()},sort(e,t){const{options:n,getTreeEdge:i}=UInestedSortable,{depth:a,maxLevel:l}=n;let s=i(),r=t.helper.offset().left,o=1,c=l,h=t.placeholder.prevBranch(),d=(h=h[0]===t.item[0]?h.prevBranch():h).getBranchLevel();c=Math.min(d+1,l);let p=1;if(t.placeholder.nextSibling().length)p=t.placeholder.getBranchLevel()||1;else{p=t.placeholder.nextBranch().getBranchLevel()||1}o=Math.max(1,p);let g=Math.max(0,r-s),u=Math.floor(g/a)+1;if(u=Math.max(o,Math.min(u,c)),(e=>{let t=e.helper.offset().top+z,n=e.placeholder.nextBranch(),i=n.offset()||0,a=n.outerHeight();return t>i.top+a/3})(t)){let e=t.placeholder.nextBranch();e.getDescendants().length&&(u=e.getBranchLevel()+1),e.after(t.placeholder),$(this).sortable("refreshPositions")}var v,f;v=t.placeholder,f=u,v.updateBranchLevel(f),L=f},change(e,t){let n=t.placeholder.prevBranch(),i=(n=n[0]===t.item[0]?n.prevBranch():n).getBranchLevel()||1;if(n.length){t.placeholder.detach();let e=n.getDescendants();e&&e.length&&(i+=1),t.placeholder.updateBranchLevel(i),n.after(t.placeholder)}},stop(e,n){$(`${u}:not(${v}-1) ${g}`).show();const i=D.children().insertAfter(n.item);D.empty(),0==n.item.next().getDescendants().length&&$(m).html(""),n.item.updateBranchLevel(L),i.shiftBranchLevel(L-O),$(this).addIcons(),$(this).calculateSiblingDistances(),a();const r=n.item.getParent();n.item.data(f.parent,r.data(f.id)).attr(`data-${f.parent}`,r.data(f.id)),l(),L===O&&w===n.item.index()||t.onComplete(n,s()),i.length>0&&(n.item.updateCollapse(),i.each(function(){$(this).updateCollapse()}))}})}};return UInestedSortable}jQuery.fn.BsNestedSortable=function(e){data=e.hasOwnProperty("data")?e.data:data;const t=new BsNestedSortable;let n="";return $(this[0]).attr("id")&&(n+="#"+$(this[0]).attr("id")),$(this[0]).attr("class")&&(n+="."+$.trim($(this[0]).attr("class")).replace(/\s/gi,".")),t.options={...t.options,...{treeSelector:n}},e.hasOwnProperty("options")&&(t.options={...t.options,...e.options}),$(this[0]).html(t.MakeContents(data)),void 0!==e.serialize&&(t.serializeOption={...t.serializeOption,...e.serialize,...{serialize:!0}}),void 0!==e.eventsOptions&&(t.serializeOption={...t.serializeOption,...{serialize:!0}},t.eventsOptions={...t.eventsOptions,...e.eventsOptions}),t.run(),this};